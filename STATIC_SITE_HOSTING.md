# Static Site Hosting with Visitor Logging

## Overview

This Cloudflare Worker now supports hosting complete static sites with integrated visitor logging. You can place any static site (like those generated by Publii, Jekyll, Hugo, etc.) into the `public/` folder and it will be served automatically with invisible visitor tracking.

## Features

- ✅ **Full Static Site Support**: Place any static site structure in the `public/` folder
- ✅ **Automatic File Serving**: Serves HTML, CSS, JavaScript, images, and other assets
- ✅ **Proper MIME Types**: Automatically detects and serves files with correct content types  
- ✅ **Directory Index**: Automatically serves `index.html` for directory requests
- ✅ **Extension Auto-detection**: URLs like `/about` automatically map to `/about.html`
- ✅ **Invisible Visitor Logging**: All static site visits are logged without user knowledge
- ✅ **Seamless API Integration**: Existing IP API functionality remains fully functional
- ✅ **Performance Optimized**: Files are bundled into the Worker for fast delivery

## How to Use

### 1. Prepare Your Static Site

Place your complete static site in the `public/` directory:

```
public/
├── index.html          # Homepage
├── about.html          # About page  
├── contact.html        # Contact page
├── css/
│   └── style.css      # Stylesheets
├── js/
│   └── script.js      # JavaScript files
├── images/
│   ├── logo.png       # Images
│   └── banner.jpg
└── assets/
    └── document.pdf   # Other assets
```

### 2. Build the Static Files Bundle

Run the build script to bundle your static files into the Worker:

```bash
node build-static.js
```

This will:
- Scan all files in the `public/` directory
- Generate a `static-files.js` bundle with all your content
- Detect proper MIME types for all file types
- Handle binary files (images, PDFs, etc.) with base64 encoding

### 3. Update the Worker

The build script output needs to be copied into the `index.js` file in the `STATIC_SITE_FILES` section. Alternatively, you can automate this by modifying the build script.

### 4. Deploy

Deploy your Worker with the bundled static site:

```bash
wrangler deploy
```

## Supported File Types

The system automatically detects and serves these file types with proper MIME types:

- **HTML**: `.html`, `.htm`
- **Styles**: `.css`
- **Scripts**: `.js`
- **Images**: `.png`, `.jpg`, `.jpeg`, `.gif`, `.svg`, `.ico`
- **Fonts**: `.woff`, `.woff2`, `.ttf`, `.otf`
- **Documents**: `.pdf`, `.xml`, `.json`, `.txt`
- **Archives**: Any other file type as `application/octet-stream`

## URL Mapping

The system provides flexible URL mapping:

- `/` → `/index.html` (directory index)
- `/about/` → `/about/index.html` (subdirectory index)
- `/about` → `/about.html` (automatic extension)
- `/css/style.css` → served as-is with `text/css` MIME type
- `/images/logo.png` → served as-is with `image/png` MIME type

## Visitor Logging

All requests to static files are logged with:

- **Timestamp**: When the request was made
- **Path**: Which file/page was requested  
- **IP Address**: Visitor's IP (with Cloudflare headers)
- **User Agent**: Browser/client information
- **Referrer**: Where the visitor came from
- **Geolocation**: Country, city, timezone (via Cloudflare)
- **Method**: HTTP method (GET, POST, etc.)

### Accessing Logs

Visit the admin panel at `/admin-{random-string}` (URL shown in deployment logs) to:

- View real-time visitor statistics
- Browse detailed visitor logs
- Filter by path, country, or other criteria
- Export logs in various formats
- Clear old logs

## Integration with Existing API

The static site hosting seamlessly integrates with the existing IP API functionality:

- **API Routes**: `/json`, `/csv`, `/html`, `/xml`, `/yaml`, `/text`, `/api`, `/ip` continue to work
- **Admin Panel**: Visitor logging admin interface remains accessible  
- **Fallback**: Non-static requests fall back to IP API responses

## Example Implementation

See the included demo site in the `public/` folder for a complete example showing:

- Multi-page navigation
- CSS styling  
- Responsive design
- Integration with IP API links
- Professional presentation

## Performance Considerations

- Files are bundled into the Worker code for maximum performance
- No external file system access required
- Cached responses with appropriate headers
- Efficient binary file handling with base64 encoding
- Minimal overhead for static file serving

## Security

- Visitor logging is invisible to users
- Admin panel URL is randomly generated for security
- No authentication bypass for static files
- Same security model as existing IP API

## Migration from Other Platforms

To migrate an existing static site:

1. **From Netlify/Vercel**: Copy your build output to `public/`
2. **From Publii**: Export your site and place in `public/`  
3. **From Jekyll/Hugo**: Copy `_site` or `public` build output
4. **From React/Vue**: Copy your build/dist folder contents

The system handles any static site structure automatically.